<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rekap Honor Guru - SMA Islam Terpadu Riyadul Ulum</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
        }
        .container {
            max-width: 1300px;
            margin: 2rem auto;
            padding: 2rem;
            background-color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            position: relative; /* Required for watermark */
            z-index: 1;
        }
        /* Watermark Styling */
        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('http://googleusercontent.com/file_content/1');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.08; /* Watermark opacity */
            z-index: -1; /* Behind the content */
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #d1d5db;
            padding: 8px 10px;
            text-align: left;
            font-size: 14px;
        }
        th {
            background-color: #f3f4f6;
            font-weight: 600;
            text-align: center;
        }
        .editable {
            background-color: #fefce8; /* Light yellow background for editable cells */
        }
        [contenteditable="true"]:focus {
            outline: 2px solid #3b82f6;
            background-color: white;
        }
        .total-row td {
            font-weight: 700;
        }
        .delete-btn {
            cursor: pointer;
            color: #ef4444;
            transition: color 0.2s;
        }
        .delete-btn:hover {
            color: #b91c1c;
        }
        .control-btn {
            font-weight: 500;
            padding: 6px 12px;
            font-size: 14px;
            border-radius: 6px;
            transition: background-color 0.2s;
        }
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            display: none; /* Hidden by default */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .modal-content {
            background-color: white;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .no-print {
            /* This class will be hidden when printing the main page */
        }
        @media print {
            .no-print { display: none; }
            .container::before {
                opacity: 0.1; /* Slightly more visible on print */
            }
        }
    </style>
</head>
<body>

    <div class="container" id="main-container">
        <!-- Header Section -->
        <header class="mb-6">
            <div class="text-center">
                <h1 class="text-xl font-bold uppercase">Rekap Honor Guru</h1>
                <h2 class="text-2xl font-bold uppercase">SMA Islam Terpadu Riyadul Ulum</h2>
                <p class="text-lg font-semibold">Tahun Pelajaran 2025-2026</p>
                <p class="text-md font-semibold" id="periode-rekap"></p>
            </div>
            <hr class="my-4 border-2 border-gray-800">
        </header>

        <!-- Controls Section -->
        <div class="flex justify-between items-center mb-4 no-print">
            <div class="flex items-center space-x-4">
                <label for="bulan" class="font-semibold">Periode:</label>
                <select id="bulan" class="border border-gray-300 rounded-md px-3 py-1 text-sm">
                    <!-- Options will be generated by JavaScript -->
                </select>
            </div>
            <div class="flex items-center space-x-2">
                 <button onclick="saveData()" class="control-btn bg-yellow-400 hover:bg-yellow-500 text-black">
                    üíæ Simpan Data
                </button>
                <button onclick="showTambahGuruModal()" class="control-btn bg-blue-500 hover:bg-blue-600 text-white">
                    + Tambah Guru
                </button>
                <button onclick="cetakRekap()" class="control-btn bg-green-500 hover:bg-green-600 text-white">
                    üñ®Ô∏è Cetak Rekap
                </button>
                 <button onclick="cetakSlip()" class="control-btn bg-purple-500 hover:bg-purple-600 text-white">
                    üìÑ Cetak Slip Honor
                </button>
                <span id="save-status" class="text-sm text-green-600 ml-2"></span>
            </div>
        </div>

        <!-- Main Table -->
        <div class="overflow-x-auto">
            <table id="honor-table">
                <thead>
                    <tr>
                        <th rowspan="2">No.</th>
                        <th rowspan="2">Daftar Nama Guru</th>
                        <th colspan="3">Honor Jam Ajar (JA)</th>
                        <th colspan="3">Honor Tatap Muka (TM)</th>
                        <th rowspan="2">Tunjangan Jabatan (Rp)</th>
                        <th rowspan="2">Total Diterima (Rp)</th>
                        <th rowspan="2">Paraf</th>
                        <th rowspan="2" class="no-print">Aksi</th>
                    </tr>
                    <tr>
                        <th>JJA</th>
                        <th>Besaran (Rp)</th>
                        <th>Jumlah (Rp)</th>
                        <th>JTM</th>
                        <th>Besaran (Rp)</th>
                        <th>Jumlah (Rp)</th>
                    </tr>
                </thead>
                <tbody id="teacher-list">
                    <!-- Teacher rows will be generated by JavaScript -->
                </tbody>
                <tfoot class="total-row bg-gray-100">
                    <tr>
                        <td colspan="2" class="text-center font-bold">JUMLAH TOTAL</td>
                        <td id="total-jja" class="text-center">0</td>
                        <td></td>
                        <td id="total-honor-ja" class="text-right">0</td>
                        <td id="total-jtm" class="text-center">0</td>
                        <td></td>
                        <td id="total-honor-tm" class="text-right">0</td>
                        <td id="total-tunjangan" class="text-right">0</td>
                        <td id="grand-total" class="text-right">0</td>
                        <td colspan="2"></td>
                    </tr>
                </tfoot>
            </table>
        </div>

        <!-- Footer/Approval Section -->
        <footer class="mt-12 flex justify-end">
            <div class="text-left">
                <p>Pamekasan, <span id="tanggal-sekarang" contenteditable="true">11 Agustus 2025</span></p>
                <p class="mt-1">Mengetahui,</p>
                <p>Kepala SMA Islam Terpadu Riyadul Ulum</p>
                <div class="mt-20">
                    <p id="kepala-sekolah" class="font-bold underline" contenteditable="true" style="min-width: 200px;">( Ach. Shoheb Sonhaji, S.Hum )</p>
                    <p id="nip-kepsek" contenteditable="true">NIP/NUPTK: -</p>
                </div>
            </div>
        </footer>
    </div>

    <!-- Modal for Adding Teacher -->
    <div id="add-teacher-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 class="text-lg font-bold mb-4">Tambah Guru Baru</h3>
            <div>
                <label for="new-teacher-name" class="block text-sm font-medium text-gray-700">Nama Guru</label>
                <input type="text" id="new-teacher-name" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div class="mt-6 flex justify-end space-x-2">
                <button onclick="hideTambahGuruModal()" class="control-btn bg-gray-200 hover:bg-gray-300 text-black">Batal</button>
                <button onclick="tambahGuru()" class="control-btn bg-blue-500 hover:bg-blue-600 text-white">Simpan</button>
            </div>
        </div>
    </div>

    <script>
        // --- GLOBAL STATE ---
        let currentTeacherData = [];
        const defaultTeachers = [
            "Ach. Shoheb Sonhaji, S.Hum", "Hepni, S.Pd.I", "Ach. Faruq, S.Sos", "Adi Sucipno, S.Pd",
            "Aliya Fatma, S.Si", "Fadilah, S.Pd", "Haris Supriadi, S.Pd", "Holifah, S.Pd",
            "Imroatus sholihah, S.Pd.I", "Irmayanti Oktavia, S.Pd", "Junaidi, S.Pd", "Kusairi, S.Pd",
            "Moh. Umarul Faruq, S.Pd", "Muzammil Muhalli, S.Pd", "Ach. Wisol, S.Sos", "Amalia Tanti Rianti, S.H",
            "Wardatut Toli'ah, S.Psi", "Mohammad Sundus, S.Pd.I", "Faisol", "Guru Tugas", "Kegiatan Bulanan"
        ];
        
        // --- UTILITY FUNCTIONS ---
        function formatCurrency(num) {
            return new Intl.NumberFormat('id-ID').format(num);
        }

        function parseCurrency(str) {
            return Number(String(str).replace(/[^0-9,-]+/g,"").replace(',','.')) || 0;
        }

        // --- DOM MANIPULATION & RENDERING ---
        function renderTable() {
            const tableBody = document.getElementById('teacher-list');
            tableBody.innerHTML = ''; // Clear the table first

            currentTeacherData.forEach((teacher, index) => {
                const row = tableBody.insertRow();
                const jumlahJA = (teacher.jja || 0) * (teacher.besaranJA || 0);
                const jumlahTM = (teacher.jtm || 0) * (teacher.besaranTM || 0);
                const totalDiterima = jumlahJA + jumlahTM + (teacher.tunjangan || 0);

                row.innerHTML = `
                    <td class="text-center">${index + 1}</td>
                    <td contenteditable="true">${teacher.name}</td>
                    <td class="editable text-center" contenteditable="true">${teacher.jja || 0}</td>
                    <td class="editable text-right" contenteditable="true">${formatCurrency(teacher.besaranJA || 0)}</td>
                    <td class="text-right bg-gray-50">${formatCurrency(jumlahJA)}</td>
                    <td class="editable text-center" contenteditable="true">${teacher.jtm || 0}</td>
                    <td class="editable text-right" contenteditable="true">${formatCurrency(teacher.besaranTM || 0)}</td>
                    <td class="text-right bg-gray-50">${formatCurrency(jumlahTM)}</td>
                    <td class="editable text-right" contenteditable="true">${formatCurrency(teacher.tunjangan || 0)}</td>
                    <td class="text-right bg-gray-50 font-semibold">${formatCurrency(totalDiterima)}</td>
                    <td></td>
                    <td class="text-center no-print">
                        <span class="delete-btn" onclick="hapusGuru(${index})">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-trash-fill inline-block" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1H2.5zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5zM8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5zm3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0z"/></svg>
                        </span>
                    </td>
                `;

                row.querySelectorAll('[contenteditable="true"]').forEach(cell => {
                    cell.addEventListener('blur', (e) => {
                        const cellIndex = e.target.cellIndex;
                        const value = e.target.textContent;
                        switch (cellIndex) {
                            case 1: currentTeacherData[index].name = value; break;
                            case 2: currentTeacherData[index].jja = parseCurrency(value); break;
                            case 3: currentTeacherData[index].besaranJA = parseCurrency(value); break;
                            case 5: currentTeacherData[index].jtm = parseCurrency(value); break;
                            case 6: currentTeacherData[index].besaranTM = parseCurrency(value); break;
                            case 8: currentTeacherData[index].tunjangan = parseCurrency(value); break;
                        }
                        renderTable();
                    });
                });
            });
            calculateAllTotals();
        }

        // --- CALCULATION FUNCTIONS ---
        function calculateAllTotals() {
            let totalJJA = 0, totalHonorJA = 0, totalJTM = 0, totalHonorTM = 0, grandTotal = 0;
            let totalTunjangan = 0;

            currentTeacherData.forEach(teacher => {
                const jja = teacher.jja || 0;
                const besaranJA = teacher.besaranJA || 0;
                const jtm = teacher.jtm || 0;
                const besaranTM = teacher.besaranTM || 0;
                const tunjangan = teacher.tunjangan || 0;
                const jumlahJA = jja * besaranJA;
                const jumlahTM = jtm * besaranTM;

                totalJJA += jja;
                totalHonorJA += jumlahJA;
                totalJTM += jtm;
                totalHonorTM += jumlahTM;
                totalTunjangan += tunjangan;
                grandTotal += jumlahJA + jumlahTM + tunjangan;
            });

            document.getElementById('total-jja').textContent = totalJJA;
            document.getElementById('total-honor-ja').textContent = formatCurrency(totalHonorJA);
            document.getElementById('total-jtm').textContent = totalJTM;
            document.getElementById('total-honor-tm').textContent = formatCurrency(totalHonorTM);
            document.getElementById('total-tunjangan').textContent = formatCurrency(totalTunjangan);
            document.getElementById('grand-total').textContent = formatCurrency(grandTotal);
        }

        // --- USER ACTIONS (MODAL) ---
        function showTambahGuruModal() {
            document.getElementById('add-teacher-modal').style.display = 'flex';
            document.getElementById('new-teacher-name').focus();
        }

        function hideTambahGuruModal() {
            document.getElementById('add-teacher-modal').style.display = 'none';
            document.getElementById('new-teacher-name').value = '';
        }

        function tambahGuru() {
            const nameInput = document.getElementById('new-teacher-name');
            const name = nameInput.value.trim();
            if (name) {
                currentTeacherData.push({ name: name });
                renderTable();
                hideTambahGuruModal();
            } else {
                alert("Nama guru tidak boleh kosong.");
            }
        }

        function hapusGuru(index) {
            const teacherName = currentTeacherData[index].name;
            if (confirm(`Apakah Anda yakin ingin menghapus guru "${teacherName}"?`)) {
                currentTeacherData.splice(index, 1);
                renderTable();
            }
        }
        
        // --- DATA PERSISTENCE ---
        function getStorageKey() {
            const bulanSelect = document.getElementById('bulan');
            const selectedMonth = bulanSelect.value;
            const selectedYear = bulanSelect.options[bulanSelect.selectedIndex].text.split(' ')[1];
            return `honorAppData_${selectedMonth}_${selectedYear}`;
        }

        function saveData() {
            const storageKey = getStorageKey();
            const dataToSave = {
                teachers: currentTeacherData,
                kepalaSekolah: document.getElementById('kepala-sekolah').textContent,
                nipKepsek: document.getElementById('nip-kepsek').textContent,
                tanggal: document.getElementById('tanggal-sekarang').textContent
            };
            localStorage.setItem(storageKey, JSON.stringify(dataToSave));
            
            const statusEl = document.getElementById('save-status');
            statusEl.textContent = 'Data berhasil disimpan!';
            setTimeout(() => { statusEl.textContent = ''; }, 3000);
        }

        function loadData() {
            const storageKey = getStorageKey();
            const savedData = localStorage.getItem(storageKey);
            
            if (savedData) {
                const parsedData = JSON.parse(savedData);
                currentTeacherData = parsedData.teachers;
                document.getElementById('kepala-sekolah').textContent = parsedData.kepalaSekolah || '( Isikan Nama Kepala Sekolah )';
                document.getElementById('nip-kepsek').textContent = parsedData.nipKepsek || 'NIP/NUPTK: -';
                document.getElementById('tanggal-sekarang').textContent = parsedData.tanggal || new Date().toLocaleDateString('id-ID', { day: 'numeric', month: 'long', year: 'numeric' });

            } else {
                // If no data for this month, start with a default list
                currentTeacherData = defaultTeachers.map(name => ({ name: name }));
            }
            renderTable();
        }

        // --- PRINT FUNCTIONS ---
        function cetakRekap() {
            const printContent = document.getElementById('main-container').cloneNode(true);
            printContent.querySelectorAll('.no-print').forEach(el => el.remove());

            // Set the period text for printing
            const periodeText = document.getElementById('bulan').options[document.getElementById('bulan').selectedIndex].text;
            printContent.querySelector('#periode-rekap').textContent = 'Periode: ' + periodeText;
            
            const printWindow = window.open('', '', 'height=800,width=1200');
            printWindow.document.write('<html><head><title>Cetak Rekap Honor</title>');
            printWindow.document.write(`
                <style> 
                    @page { 
                        size: 330mm 215mm; /* F4 Landscape */
                        margin: 10mm; 
                    } 
                    body { 
                        font-family: "Times New Roman", Times, serif; 
                        -webkit-print-color-adjust: exact; 
                    } 
                    
                    /* Header Styling */
                    header .text-center { 
                        text-align: center !important;
                    }
                    header .text-center h1,
                    header .text-center h2,
                    header .text-center p {
                        margin: 0 !important;
                        line-height: 1.15 !important;
                    }
                    header .text-center h1 { font-size: 16pt !important; font-weight: bold; }
                    header .text-center h2 { font-size: 18pt !important; font-weight: bold; }
                    header .text-center p { font-size: 12pt !important; }
                    hr {
                        border-top: 2px solid black !important;
                        margin: 8px 0 !important;
                    }

                    /* Table Styling */
                    table { width: 100%; border-collapse: collapse; } 
                    th, td { border: 1px solid black !important; padding: 2px 4px; font-size: 9pt; vertical-align: middle; } 
                    th { background-color: #e5e7eb !important; } 
                    .bg-gray-50 { background-color: #f9fafb !important; } 
                    .font-semibold { font-weight: 600; } 
                    .text-right { text-align: right; } 
                    .text-center { text-align: center; } 
                    
                    /* Footer Styling */
                    footer { margin-top: 20px !important; display: flex; justify-content: flex-end; } 
                    footer > div { text-align: left; }
                </style>
            `);
            printWindow.document.write('</head><body>');
            printWindow.document.write(printContent.innerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            setTimeout(() => { printWindow.print(); }, 500);
        }

        function cetakSlip() {
            const periode = document.getElementById('bulan').selectedOptions[0].text;
            const teacherData = currentTeacherData;
            
            let slipsHTML = '';
            teacherData.forEach(teacher => {
                const jumlahJA = (teacher.jja || 0) * (teacher.besaranJA || 0);
                const jumlahTM = (teacher.jtm || 0) * (teacher.besaranTM || 0);
                const total = jumlahJA + jumlahTM + (teacher.tunjangan || 0);

                slipsHTML += `
                    <div class="slip">
                        <h4 class="slip-title">SLIP HONOR GURU</h4>
                        <p class="slip-subtitle">SMA Islam Terpadu Riyadul Ulum</p>
                        <p class="slip-periode">Periode: ${periode}</p>
                        <hr class="slip-hr">
                        <p><strong>Nama:</strong> ${teacher.name}</p>
                        <table class="slip-table">
                            <tr><td>Honor JA</td><td>: ${teacher.jja || 0} x ${formatCurrency(teacher.besaranJA || 0)}</td><td class="slip-amount">Rp ${formatCurrency(jumlahJA)}</td></tr>
                            <tr><td>Honor TM</td><td>: ${teacher.jtm || 0} x ${formatCurrency(teacher.besaranTM || 0)}</td><td class="slip-amount">Rp ${formatCurrency(jumlahTM)}</td></tr>
                            <tr><td>Tunjangan</td><td>:</td><td class="slip-amount">Rp ${formatCurrency(teacher.tunjangan || 0)}</td></tr>
                            <tr class="slip-total"><td><strong>Total</strong></td><td>:</td><td class="slip-amount"><strong>Rp ${formatCurrency(total)}</strong></td></tr>
                        </table>
                        <div class="slip-signature">
                            <div><p>Bendahara,</p><br><br><p>(.....................)</p></div>
                            <div><p>Penerima,</p><br><br><p>(${teacher.name})</p></div>
                        </div>
                    </div>
                `;
            });

            const printWindow = window.open('', '', 'height=800,width=1200');
            printWindow.document.write('<html><head><title>Cetak Slip Honor</title>');
            printWindow.document.write(`
                <style>
                    @page { size: 330mm 215mm; margin: 6mm; }
                    body { font-family: Arial, sans-serif; font-size: 6pt; }
                    .slip-container { display: grid; grid-template-columns: repeat(5, 1fr); grid-template-rows: repeat(3, 1fr); grid-gap: 2.5mm; height: 199mm; }
                    .slip { border: 1px solid #000; padding: 1.5mm; page-break-inside: avoid; display: flex; flex-direction: column;}
                    .slip-title { font-size: 7pt; font-weight: bold; text-align: center; margin: 0; }
                    .slip-subtitle { font-size: 6.5pt; text-align: center; margin: 0 0 1mm 0; }
                    .slip-periode { font-size: 5.5pt; text-align: center; margin-bottom: 1mm; }
                    .slip-hr { border-top: 1px solid #000; margin: 1mm 0; }
                    .slip p { margin: 0 0 0.5mm 0; }
                    .slip-table { width: 100%; border-collapse: collapse; margin-top: 1mm; }
                    .slip-table td { padding: 0 0.5mm; vertical-align: top;}
                    .slip-amount { text-align: right; white-space: nowrap; }
                    .slip-total td { border-top: 1px solid #000; padding-top: 0.5mm; font-weight: bold; }
                    .slip-signature { display: flex; justify-content: space-between; margin-top: auto; padding-top: 1mm; font-size: 5.5pt; }
                    .slip-signature p { margin: 0; }
                </style>
            `);
            printWindow.document.write('</head><body>');
            printWindow.document.write(`<div class="slip-container">${slipsHTML}</div>`);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
             setTimeout(() => { printWindow.print(); }, 500);
        }
        
        // --- APP INITIALIZATION ---
        function initializeApp() {
            const bulanSelect = document.getElementById('bulan');
            const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            const currentYear = new Date().getFullYear();
            const currentMonth = new Date().getMonth();
            months.forEach((month) => {
                bulanSelect.add(new Option(`${month} ${currentYear}`, month));
            });
            bulanSelect.selectedIndex = currentMonth;
            
            // Add event listener for month change
            bulanSelect.addEventListener('change', loadData);

            loadData();
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>

</body>
</html>

